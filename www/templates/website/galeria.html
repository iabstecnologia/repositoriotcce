{% extends "base/base.html" %}
{% load static %}

{% block title %}Página Inicial - Repositório TCCEs{% endblock title %}

{% block extra_css %}
<style>
    .thumbnail-img {
        aspect-ratio: 4 / 3;
        object-fit: cover;
    }
    .thumb-width {
        width: 15%;
    }
    .main-image {
        aspect-ratio: 16 / 9;
        object-fit: cover;
        width: 100%;
        height: 100%;
        display: block;
    }
    #main-display {
        position: relative;
    }
    .description-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 1rem;
        background-color: rgba(0, 0, 0, 0.65);
        color: white;
        border-bottom-left-radius: 0.75rem;
        border-bottom-right-radius: 0.75rem;
    }
    .thumbnail-active {
        border: 4px solid #10b981;
        transform: scale(1.05);
        opacity: 1;
    }
    .thumbnail-item {
        transition: all 0.2s ease-in-out;
        opacity: 0.7;
        cursor: pointer;
        overflow: hidden;
    }
    #main-photo, #image-description {
        transition: opacity 0.3s ease-in-out;
    }
    .carousel-control-custom {
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        
    }
    #thumbnails-list {
        overflow-x: auto;
        white-space: nowrap;
    }
    @media (max-width: 768px) {
        .description-overlay {
            position: static;
            background-color: white;
            color: #333;
            padding: 1rem 1rem 1rem 1rem;
            box-shadow: none;
        }
        #main-photo {
            border-bottom-left-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }
        .carousel-control-custom {
            top: 35%;
            transform: translateY(-40%);
            z-index: 10;
        }
    }
</style>
{% endblock extra_css %}

{% block hero_title %}
    Galeria
{% endblock hero_title %}

{% block hero_content %}{% endblock hero_content %}

{% block content %}

<!-- Divider -->
<div class="divider mt-1"></div>

<!-- Gallery Section -->
<div class="container py-5 position-relative z-1 mt-neg-150">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Container Principal da Galeria (Simulando o card) -->
            <div id="gallery-container" class="bg-custom-light-gray p-sm-5 p-4 rounded-4 shadow-lg">

                <!-- GALERIA PRINCIPAL (CARROSSEL) -->
                <div id="main-display" class="rounded-4 shadow-lg overflow-hidden">

                    <!-- Contêiner da Imagem Principal e Descrição -->
                    <div id="image-container" class="position-relative">

                        <!-- Imagem Principal -->
                        <img id="main-photo"
                            src="https://placehold.co/1200x675/000000/FFFFFF?text=Imagem+Caverna+1"
                            alt="Imagem Principal da Galeria"
                            class="main-image rounded-4"
                            onerror="this.src='https://placehold.co/1200x675/2563eb/FFFFFF?text=Erro+ao+Carregar+Imagem'">

                        <!-- Sobreposição da Descrição -->
                        <div id="description-overlay" class="description-overlay rounded-bottom-4">
                            <p id="image-description" class="mb-0 fs-6 text-center">
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris imperdiet gravida orci, eu consectetur tellus aliquet vitae. Nunc suscipit gravida erat. Donec porttitor fermentum neque.
                            </p>
                        </div>

                        <!-- Botão de Navegação: Anterior -->
                        <button id="prev-btn" class="position-absolute start-0 carousel-control-custom p-3 bg-dark bg-opacity-50 border-0 text-white rounded-end-4 transition duration-150 focus-ring">
                            <i class="bi bi-chevron-left fs-4"></i>
                        </button>

                        <!-- Botão de Navegação: Próximo -->
                        <button id="next-btn" class="position-absolute end-0 carousel-control-custom p-3 bg-dark bg-opacity-50 border-0 text-white rounded-start-4 transition duration-150 focus-ring">
                            <i class="bi bi-chevron-right fs-4"></i>
                        </button>
                    </div>
                </div>

                <!-- MINIATURAS (THUMBNAILS) -->
                <div id="thumbnails-wrapper" class="mt-4">
                    <div id="thumbnails-list" class="d-flex flex-row p-1 justify-content-between">
                        <!-- Miniaturas serão injetadas aqui pelo JavaScript -->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block extra_js %}
<script>
    // Array de dados simulando as imagens e descrições
    const GALLERY_DATA = [
        {
            id: 0,
            src: "{% static 'assets/imagem-caverna-sliede.webp' %}",
            description: "Caverna principal com formações rochosas espetaculares. Um espeleólogo explora o salão central com sua lanterna de cabeça."
        },
        {
            id: 1,
            src: "https://placehold.co/1200x675/1e40af/FFFFFF?text=Estalactites+e+Estalagmites",
            description: "Detalhe de estalactites e estalagmites, evidência da lenta formação geológica ao longo de milênios. A umidade é alta."
        },
        {
            id: 2,
            src: "https://placehold.co/1200x675/059669/FFFFFF?text=Rio+Subterrâneo",
            description: "Caminho formado por um rio subterrâneo, destacando a importância hídrica do ecossistema cárstico. A água está cristalina."
        },
        {
            id: 3,
            src: "https://placehold.co/1200x675/f59e0b/000000?text=Morcegos+em+Repouso",
            description: "Colônia de morcegos em repouso no teto da caverna, essenciais para a biodiversidade local. É importante manter a distância."
        },
        {
            id: 4,
            src: "https://placehold.co/1200x675/dc2626/FFFFFF?text=Fósseis+Raros",
            description: "Vista de perto de uma área de pesquisa contendo fósseis raros descobertos recentemente. O local está sob proteção."
        },
        {
            id: 5,
            src: "https://placehold.co/1200x675/4f46e5/FFFFFF?text=Saída+da+Gruta",
            description: "Perspectiva da saída da gruta, contrastando a escuridão interna com a luz intensa do exterior. Um convite à aventura."
        }
    ];

    let currentIndex = 0; // Índice da imagem atualmente exibida
    const mainPhoto = document.getElementById('main-photo');
    const imageDescription = document.getElementById('image-description');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const thumbnailsList = document.getElementById('thumbnails-list');

    /**
     * Atualiza a imagem principal e a descrição com base no novo índice.
     * @param {number} newIndex O índice da imagem a ser exibida.
     */
    function updateMainDisplay(newIndex) {
        // Garante o loop infinito (carrossel)
        currentIndex = (newIndex + GALLERY_DATA.length) % GALLERY_DATA.length;

        const item = GALLERY_DATA[currentIndex];

        // Adiciona/remove classe para transição suave na imagem (Fade out)
        mainPhoto.style.opacity = '0';
        imageDescription.style.opacity = '0';

        setTimeout(() => {
            // Atualiza a fonte e o texto
            mainPhoto.src = item.src;
            imageDescription.textContent = item.description;

            // Restaura a opacidade após a atualização (Fade in)
            mainPhoto.style.opacity = '1';
            imageDescription.style.opacity = '1';

            updateThumbnails();
        }, 300); // Tempo igual à transição CSS
    }

    /**
     * Atualiza a classe de destaque da miniatura ativa e centraliza a rolagem.
     */
    function updateThumbnails() {
        const thumbnails = document.querySelectorAll('.thumbnail-item');

        // Remove a classe 'active' de todas as miniaturas
        thumbnails.forEach((thumb) => {
            thumb.classList.remove('thumbnail-active');
        });

        // Adiciona a classe 'active' na miniatura correspondente ao currentIndex
        const activeThumbnail = document.getElementById(`thumb-${currentIndex}`);
        if (activeThumbnail) {
            activeThumbnail.classList.add('thumbnail-active');

            // Lógica de centralização da miniatura ativa
            const listRect = thumbnailsList.getBoundingClientRect();
            const thumbRect = activeThumbnail.getBoundingClientRect();

            // Calcula o quanto rolar para centralizar a miniatura
            const scrollAmount = activeThumbnail.offsetLeft - (listRect.width / 2) + (thumbRect.width / 2);

            thumbnailsList.scrollTo({
                left: scrollAmount,
                behavior: 'smooth'
            });
        }
    }

    /**
     * Renderiza as miniaturas e anexa os manipuladores de clique.
     */
    function renderThumbnails() {
        thumbnailsList.innerHTML = ''; // Limpa o contêiner

        GALLERY_DATA.forEach((item, index) => {
            const thumbDiv = document.createElement('div');
            thumbDiv.id = `thumb-${index}`;
            // Classes Bootstrap: arredondamento, sombra, padding e largura responsiva
            thumbDiv.className = `thumbnail-item rounded-4 shadow-sm p-1 thumb-width`;
            thumbDiv.setAttribute('data-index', index);

            const thumbImg = document.createElement('img');
            thumbImg.src = item.src;
            thumbImg.alt = `Miniatura ${index + 1}`;
            thumbImg.className = 'thumbnail-img w-100 h-100 rounded-3';

            thumbDiv.appendChild(thumbImg);
            thumbnailsList.appendChild(thumbDiv);

            // Anexa o evento de clique na miniatura
            thumbDiv.addEventListener('click', () => {
                const newIndex = parseInt(thumbDiv.getAttribute('data-index'));
                updateMainDisplay(newIndex);
            });
        });

        // Inicializa a ativação da primeira miniatura
        updateThumbnails();
    }

    // ===============================================
    // Inicialização e Event Listeners
    // ===============================================

    document.addEventListener('DOMContentLoaded', () => {
        renderThumbnails();
        updateMainDisplay(currentIndex); // Inicializa com a primeira imagem

        // Evento para o botão Anterior
        prevBtn.addEventListener('click', () => {
            updateMainDisplay(currentIndex - 1);
        });

        // Evento para o botão Próximo
        nextBtn.addEventListener('click', () => {
            updateMainDisplay(currentIndex + 1);
        });
    });
</script>
{% endblock extra_js %}